<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PM2.5 Professional Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>

<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:#1e1e2f;
    color:#fff;
}

.header{
    padding:20px;
    text-align:center;
    font-size:24px;
    font-weight:bold;
    background:#111827;
}

.dashboard{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:20px;
    padding:20px;
}

.card{
    background:#2a2a40;
    padding:20px;
    border-radius:15px;
    box-shadow:0 4px 15px rgba(0,0,0,0.4);
}

.pm-number{
    font-size:48px;
    font-weight:bold;
}

#map{
    width:100%;
    height:400px;
    border-radius:10px;
}

.advice{
    margin-top:10px;
    font-size:18px;
}

@media(max-width:768px){
    .dashboard{
        grid-template-columns:1fr;
    }
    #map{
        height:300px;
    }
}
</style>
</head>

<body>

<div class="header">üå´Ô∏è PM2.5 Air Quality Dashboard (Real-time)</div>

<div class="dashboard">

    <div class="card">
        <h2>‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>
        <div id="location">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...</div>
        <div class="pm-number" id="pmValue">--</div>
        <div>‡∏Ñ‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ ‚â§ 37.5 ¬µg/m¬≥</div>
        <div class="advice" id="healthAdvice"></div>
    </div>

    <div class="card">
        <h2>‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á</h2>
        <canvas id="pmChart"></canvas>
    </div>

    <div class="card" style="grid-column: span 2;">
        <h2>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>
        <div id="map"></div>
    </div>

</div>

<script>
const TOKEN = "28d1b5b3fd38de7d3c494d2580af5790b51bf4a3";
let map, marker;

function getColor(pm){
    if(pm <= 37.5) return "#2ecc71";
    if(pm <= 75) return "#f1c40f";
    if(pm <= 150) return "#e67e22";
    return "#e74c3c";
}

function getAdvice(pm){
    if(pm <= 37.5) 
        return "‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥";
    if(pm <= 75) 
        return "‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á";
    if(pm <= 150) 
        return "‡∏Ñ‡∏ß‡∏£‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å N95 ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á";
    return "‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏°‡∏≤‡∏Å ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ü‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®";
}

function initMap(lat, lon){
    map = new google.maps.Map(document.getElementById("map"), {
        zoom: 12,
        center: {lat: lat, lng: lon},
    });

    marker = new google.maps.Marker({
        position: {lat: lat, lng: lon},
        map: map,
        title: "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
    });
}

function loadPM(lat, lon){
    fetch(`https://api.airvisual.com/v2/nearest_city?lat=${lat}&lon=${lon}&key=${TOKEN}`)
    .then(res=>res.json())
    .then(data=>{
        const pm = data.data.current.pollution.aqius;

        document.getElementById("pmValue").innerHTML = pm + " ¬µg/m¬≥";
        document.getElementById("healthAdvice").innerHTML = getAdvice(pm);
        document.getElementById("location").innerHTML =
            data.data.city + ", " + data.data.state;

        document.body.style.background = getColor(pm);

        createChart(pm);
    });
}

function createChart(pm){
    new Chart(document.getElementById('pmChart'),{
        type:'bar',
        data:{
            labels:["‡∏î‡∏µ","‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á","‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏°‡∏≤‡∏Å"],
            datasets:[{
                data:[
                    pm<=37.5?pm:0,
                    pm>37.5 && pm<=75?pm:0,
                    pm>150?pm:0
                ],
                backgroundColor:[
                    "#2ecc71","#f1c40f","#e74c3c"
                ]
            }]
        },
        options:{
            responsive:true,
            plugins:{legend:{display:false}},
            scales:{y:{beginAtZero:true}}
        }
    });
}

if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        initMap(lat,lon);
        loadPM(lat,lon);
    },()=>{
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á");
    });
}else{
    alert("‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Geolocation");
}
</script>

</body>
</html>
