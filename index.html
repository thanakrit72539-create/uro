<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô PM2.5 ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family: 'Segoe UI', sans-serif;
    margin:0;
    padding:20px;
    text-align:center;
    transition: background 0.5s ease;
}
.container{
    max-width:900px;
    margin:auto;
    background:white;
    padding:20px;
    border-radius:15px;
    box-shadow:0 10px 25px rgba(0,0,0,0.1);
}
h1{ margin-bottom:15px; }

select,input,button{
    padding:10px;
    font-size:16px;
    border-radius:8px;
    border:1px solid #ccc;
    margin:5px;
}

button{
    background:#2196F3;
    color:white;
    cursor:pointer;
}

.pm-value{
    font-size:55px;
    font-weight:bold;
}

.status{
    font-size:22px;
    margin:10px 0;
}

.advice{
    padding:15px;
    border-radius:10px;
    font-size:18px;
    margin-top:10px;
}

canvas{ margin-top:20px; }

@media (max-width:600px){
    .pm-value{ font-size:38px; }
}
</style>
</head>
<body>

<div class="container">
<h1>üå´ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô PM2.5 ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢</h1>

<!-- ‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
<input list="provinceList" id="provinceInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà">
<datalist id="provinceList"></datalist>

<!-- Dropdown -->
<br>
<select id="provinceSelect"></select>
<button onclick="fetchPM25()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>

<h2 id="location"></h2>
<div class="pm-value" id="pm25">--</div>
<div class="status" id="status"></div>
<div class="advice" id="advice"></div>
<canvas id="pmChart"></canvas>

</div>

<script>
const TOKEN = "28d1b5b3fd38de7d3c494d2580af5790b51bf4a3";
let chart;

/* ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ 77 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î */
const provinces = [
"Bangkok","Samut Prakan","Nonthaburi","Pathum Thani","Phra Nakhon Si Ayutthaya",
"Ang Thong","Lopburi","Sing Buri","Chai Nat","Saraburi",
"Chonburi","Rayong","Chanthaburi","Trat","Chachoengsao",
"Prachinburi","Nakhon Nayok","Sa Kaeo",
"Nakhon Ratchasima","Buri Ram","Surin","Si Sa Ket","Ubon Ratchathani",
"Yasothon","Chaiyaphum","Amnat Charoen","Nong Bua Lamphu",
"Khon Kaen","Udon Thani","Loei","Nong Khai","Maha Sarakham",
"Roi Et","Kalasin","Sakon Nakhon","Nakhon Phanom","Mukdahan",
"Chiang Mai","Lamphun","Lampang","Uttaradit","Phrae",
"Nan","Phayao","Chiang Rai","Mae Hong Son",
"Nakhon Sawan","Uthai Thani","Kamphaeng Phet","Tak",
"Sukhothai","Phitsanulok","Phichit","Phetchabun",
"Ratchaburi","Kanchanaburi","Suphan Buri","Nakhon Pathom",
"Samut Sakhon","Samut Songkhram","Phetchaburi","Prachuap Khiri Khan",
"Nakhon Si Thammarat","Krabi","Phang Nga","Phuket",
"Surat Thani","Ranong","Chumphon",
"Songkhla","Satun","Trang","Phatthalung",
"Pattani","Yala","Narathiwat","Bueng Kan"
];

/* ‡πÇ‡∏´‡∏•‡∏î dropdown ‡πÅ‡∏•‡∏∞ datalist */
const select = document.getElementById("provinceSelect");
const datalist = document.getElementById("provinceList");

provinces.forEach(p=>{
    let option = document.createElement("option");
    option.value = p;
    select.appendChild(option);

    let dataOption = document.createElement("option");
    dataOption.value = p;
    datalist.appendChild(dataOption);
});

function getAdvice(pm){
    if(pm <= 25){
        return "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥";
    }else if(pm <= 50){
        return "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö ‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á";
    }else{
        return "‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏Ñ‡∏ß‡∏£‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å N95 ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á";
    }
}

function getStatus(pm){
    if(pm <= 25) return {text:"‡∏õ‡∏Å‡∏ï‡∏¥",color:"#4CAF50"};
    if(pm <= 50) return {text:"‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á",color:"#FF9800"};
    return {text:"‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏°‡∏≤‡∏Å",color:"#F44336"};
}

function createChart(pm){
    if(chart) chart.destroy();
    chart = new Chart(document.getElementById("pmChart"),{
        type:"bar",
        data:{
            labels:["‡∏ô‡πâ‡∏≠‡∏¢","‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á","‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏°‡∏≤‡∏Å"],
            datasets:[{
                data:[
                    Math.min(pm,25),
                    pm>25?Math.min(pm-25,25):0,
                    pm>50?pm-50:0
                ],
                backgroundColor:["#4CAF50","#FF9800","#F44336"]
            }]
        },
        options:{
            plugins:{legend:{display:false}},
            scales:{y:{beginAtZero:true}}
        }
    });
}

function fetchPM25(){
    const inputProvince = document.getElementById("provinceInput").value;
    const selectedProvince = select.value;
    const province = inputProvince || selectedProvince;

    if(!province) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î");

    fetch(`https://api.waqi.info/feed/${province}/?token=${TOKEN}`)
    .then(res=>res.json())
    .then(data=>{
        if(data.status !== "ok"){
            document.getElementById("pm25").innerHTML="‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            return;
        }

        const pm = data.data.iaqi.pm25.v;
        document.getElementById("location").innerHTML=data.data.city.name;
        document.getElementById("pm25").innerHTML=pm+" ¬µg/m¬≥";

        const status=getStatus(pm);
        document.getElementById("status").innerHTML=status.text;
        document.getElementById("status").style.color=status.color;
        document.getElementById("advice").innerHTML=getAdvice(pm);
        document.getElementById("advice").style.background=status.color+"20";

        document.body.style.background=status.color+"30";

        createChart(pm);
    })
    .catch(()=>document.getElementById("pm25").innerHTML="‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
}
</script>

</body>
</html>
