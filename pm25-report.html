<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô PM2.5 ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family: 'Segoe UI', sans-serif;
    margin:0;
    padding:20px;
    text-align:center;
    transition: background 0.5s ease;
}
.container{
    max-width:900px;
    margin:auto;
    background:white;
    padding:20px;
    border-radius:15px;
    box-shadow:0 10px 25px rgba(0,0,0,0.1);
}
h1{
    margin-bottom:10px;
}
.pm-value{
    font-size:60px;
    font-weight:bold;
}
.status{
    font-size:22px;
    margin-bottom:15px;
}
.advice{
    margin-top:15px;
    padding:15px;
    border-radius:10px;
    font-size:18px;
}
canvas{
    margin-top:20px;
}
.footer{
    margin-top:20px;
    font-size:14px;
    color:gray;
}
@media (max-width:600px){
    .pm-value{
        font-size:40px;
    }
}
</style>
</head>
<body>

<div class="container">
    <h1>üå´ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô PM2.5</h1>
    <div id="location">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...</div>
    <div class="pm-value" id="pm25">--</div>
    <div class="status" id="status"></div>
    <div class="advice" id="advice"></div>
    <canvas id="pmChart"></canvas>
    <div class="footer">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö Real-time</div>
</div>

<script>
const TOKEN = "28d1b5b3fd38de7d3c494d2580af5790b51bf4a3";

function getAdvice(pm){
    if(pm <= 25){
        return "‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥";
    }else if(pm <= 50){
        return "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á";
    }else{
        return "‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏Ñ‡∏ß‡∏£‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å N95 ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á";
    }
}

function getStatus(pm){
    if(pm <= 25){
        return {text:"‡∏õ‡∏Å‡∏ï‡∏¥", color:"#4CAF50"};
    }else if(pm <= 50){
        return {text:"‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á", color:"#FF9800"};
    }else{
        return {text:"‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏°‡∏≤‡∏Å", color:"#F44336"};
    }
}

function updateBackground(color){
    document.body.style.background = color;
}

function createChart(pm){
    new Chart(document.getElementById('pmChart'), {
        type: 'bar',
        data: {
            labels: ['‡∏ô‡πâ‡∏≠‡∏¢', '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', '‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏°‡∏≤‡∏Å'],
            datasets: [{
                label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô',
                data: [
                    Math.min(pm,25),
                    pm>25?Math.min(pm-25,25):0,
                    pm>50?pm-50:0
                ],
                backgroundColor: ['#4CAF50','#FF9800','#F44336']
            }]
        },
        options:{
            responsive:true,
            plugins:{
                legend:{display:false}
            },
            scales:{
                y:{beginAtZero:true}
            }
        }
    });
}

function fetchPM25(lat, lon){
    fetch(`https://api.waqi.info/feed/geo:${lat};${lon}/?token=${TOKEN}`)
    .then(res => res.json())
    .then(data => {
        const pm = data.data.iaqi.pm25.v;
        document.getElementById("pm25").innerHTML = pm + " ¬µg/m¬≥";

        const status = getStatus(pm);
        document.getElementById("status").innerHTML = status.text;
        document.getElementById("status").style.color = status.color;

        document.getElementById("advice").innerHTML = getAdvice(pm);
        document.getElementById("advice").style.background = status.color + "20";

        updateBackground(status.color + "30");

        createChart(pm);
    })
    .catch(err => {
        document.getElementById("pm25").innerHTML = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ";
    });
}

if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(position=>{
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        document.getElementById("location").innerHTML =
            "‡∏û‡∏¥‡∏Å‡∏±‡∏î: " + lat.toFixed(4) + ", " + lon.toFixed(4);
        fetchPM25(lat, lon);
    }, ()=>{
        document.getElementById("location").innerHTML =
            "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á";
    });
}else{
    document.getElementById("location").innerHTML =
        "‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Geolocation";
}
</script>

</body>
</html>
